<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVTOBUS.UZ - Online Booking System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Courier+Prime:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000080;
            background-image:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, 0.03) 2px,
                    rgba(0, 255, 255, 0.03) 4px
                );
            font-family: 'Courier Prime', monospace;
            color: #00ff00;
            overflow-x: hidden;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .marquee-container {
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
            border: 3px solid #00ff00;
            padding: 5px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        .marquee {
            font-family: 'VT323', monospace;
            font-size: 28px;
            color: #000;
            font-weight: bold;
            animation: scroll-left 20s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 42px;
            color: #00ffff;
            text-shadow:
                0 0 3px #00ffff,
                3px 3px 0px #ff00ff;
            margin-bottom: 15px;
        }

        .subtitle {
            font-family: 'VT323', monospace;
            font-size: 24px;
            color: #ffff00;
            text-shadow: 2px 2px 0px #ff00ff;
        }

        .counter {
            background: #000;
            border: 2px solid #00ff00;
            padding: 10px;
            margin: 20px auto;
            width: fit-content;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
            font-family: 'VT323', monospace;
            font-size: 20px;
            color: #0f0;
        }

        nav {
            background: linear-gradient(180deg, #008080, #004040);
            border: 3px ridge #00ffff;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 5px 5px 0px #ff00ff;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        nav a {
            color: #ffff00;
            text-decoration: none;
            font-family: 'VT323', monospace;
            font-size: 20px;
            padding: 8px 15px;
            border: 2px outset #00ff00;
            background: #006666;
            display: inline-block;
            transition: all 0.1s;
            cursor: pointer;
        }

        nav a:hover, nav a.active {
            background: #00ffff;
            color: #000;
            border-style: inset;
            transform: translateY(2px);
        }

        .main-content {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #00ff00;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow:
                0 0 20px rgba(0, 255, 0, 0.4),
                inset 0 0 20px rgba(0, 255, 0, 0.1);
        }

        h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 24px;
            color: #ff00ff;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #00ffff;
            border-bottom: 2px dashed #00ffff;
            padding-bottom: 10px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-family: 'VT323', monospace;
            font-size: 20px;
            color: #00ffff;
            margin-bottom: 5px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #00ff00;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
        }

        .btn-y2k {
            background: linear-gradient(180deg, #00ff00, #008000);
            border: 3px outset #00ff00;
            color: #000;
            padding: 12px 25px;
            font-family: 'VT323', monospace;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            box-shadow: 3px 3px 0px #004000;
            transition: all 0.1s;
        }

        .btn-y2k:hover {
            background: linear-gradient(180deg, #ffff00, #ff8800);
            border-style: inset;
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px #004000;
        }

        .bus-card {
            background: rgba(0, 50, 50, 0.6);
            border: 3px ridge #00ffff;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .bus-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 30px rgba(0, 255, 255, 0.6);
            background: rgba(0, 80, 80, 0.8);
        }

        .bus-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bus-time {
            font-family: 'Press Start 2P', cursive;
            font-size: 28px;
            color: #ffff00;
            text-shadow: 2px 2px 0px #ff00ff;
        }

        .bus-price {
            font-family: 'VT323', monospace;
            font-size: 24px;
            color: #00ff00;
            font-weight: bold;
        }

        .bus-info {
            font-family: 'VT323', monospace;
            font-size: 18px;
            color: #00ffff;
            margin: 5px 0;
        }

        .seat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .seat {
            padding: 15px;
            border: 2px solid #00ff00;
            text-align: center;
            cursor: pointer;
            background: rgba(0, 255, 0, 0.2);
            font-family: 'VT323', monospace;
            font-size: 20px;
            font-weight: bold;
            color: #00ff00;
            transition: all 0.2s;
        }

        .seat:hover:not(.taken) {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .seat.taken {
            background: rgba(255, 0, 255, 0.3);
            border-color: #ff00ff;
            cursor: not-allowed;
            color: #ff00ff;
        }

        .seat.selected {
            background: rgba(255, 255, 0, 0.4);
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.8);
            color: #ffff00;
        }

        .summary {
            background: rgba(128, 0, 128, 0.3);
            border: 3px groove #ff00ff;
            padding: 20px;
            margin: 20px 0;
        }

        .summary h3 {
            font-family: 'Press Start 2P', cursive;
            font-size: 18px;
            color: #00ffff;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-family: 'VT323', monospace;
            font-size: 20px;
            color: #00ff00;
        }

        .total {
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            color: #ffff00;
            border-top: 2px solid #00ffff;
            padding-top: 15px;
            margin-top: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
        }

        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 3px solid #00ff00;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
        }

        .success-message h2 {
            color: #00ff00;
            font-size: 28px;
            margin-bottom: 20px;
            border: none;
        }

        .blink {
            animation: blink 1.5s linear infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 2px solid #00ffff;
            padding: 12px;
            text-align: left;
            font-family: 'VT323', monospace;
            font-size: 18px;
        }

        th {
            background: rgba(128, 0, 128, 0.5);
            color: #ffff00;
            font-weight: bold;
        }

        td {
            background: rgba(0, 0, 0, 0.5);
            color: #00ff00;
        }

        .star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .sparkle {
            display: inline-block;
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        footer {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff00ff;
            margin-top: 30px;
            font-family: 'VT323', monospace;
            font-size: 18px;
            color: #00ffff;
        }

        .legend {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border: 2px solid #00ff00;
            margin-bottom: 20px;
        }

        .legend-item {
            display: inline-block;
            margin-right: 20px;
            font-family: 'VT323', monospace;
            font-size: 18px;
        }

        .legend-box {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 2px solid;
            vertical-align: middle;
            margin-right: 5px;
        }

        .processing {
            text-align: center;
            padding: 60px 20px;
        }

        .processing h2 {
            font-size: 32px;
            color: #00ffff;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }

            .seat-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }

            .seat {
                padding: 10px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <script>
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            document.body.appendChild(star);
        }
    </script>

    <div class="marquee-container">
        <div class="marquee">*** ONLINE BOOKING SYSTEM *** TOSHKENT - NAVOIY *** BEST PRICES *** COMFORTABLE BUSES *** WELCOME ***</div>
    </div>

    <div class="container">
        <header>
            <h1>AVTOBUS.UZ</h1>
            <p class="subtitle">[ Online Booking System ]</p>
            <div class="counter">VISITORS: 00012847</div>
        </header>

        <nav>
            <ul>
                <li><a href="#" class="nav-item active" data-page="search">[SEARCH] POISK</a></li>
                <li><a href="#" class="nav-item" data-page="booking">[SEATS] MESTA</a></li>
                <li><a href="#" class="nav-item" data-page="payment">[PAY] OPLATA</a></li>
                <li><a href="#" class="nav-item" data-page="tickets">[TICKETS] BILETY</a></li>
            </ul>
        </nav>

        <div class="main-content">
            <div id="search" class="page active">
                <h2><span class="sparkle">~</span> POISK AVTOBUSOV <span class="sparkle">~</span></h2>
                
                <div class="form-group">
                    <label>[FROM] OTKUDA:</label>
                    <select id="from">
                        <option value="Toshkent" selected>Toshkent</option>
                        <option value="Samarqand">Samarqand</option>
                        <option value="Buxoro">Buxoro</option>
                        <option value="Andijon">Andijon</option>
                        <option value="Farg'ona">Farg'ona</option>
                        <option value="Namangan">Namangan</option>
                        <option value="Navoiy">Navoiy</option>
                        <option value="Qarshi">Qarshi</option>
                        <option value="Termiz">Termiz</option>
                        <option value="Guliston">Guliston</option>
                        <option value="Jizzax">Jizzax</option>
                        <option value="Nukus">Nukus</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>[TO] KUDA:</label>
                    <select id="to">
                        <option value="Toshkent">Toshkent</option>
                        <option value="Samarqand">Samarqand</option>
                        <option value="Buxoro">Buxoro</option>
                        <option value="Andijon">Andijon</option>
                        <option value="Farg'ona">Farg'ona</option>
                        <option value="Namangan">Namangan</option>
                        <option value="Navoiy" selected>Navoiy</option>
                        <option value="Qarshi">Qarshi</option>
                        <option value="Termiz">Termiz</option>
                        <option value="Guliston">Guliston</option>
                        <option value="Jizzax">Jizzax</option>
                        <option value="Nukus">Nukus</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>[DATE] DATA POEZDKI:</label>
                    <input type="date" id="date">
                </div>

                <button class="btn-y2k" onclick="searchBuses()">[SEARCH] NAITI AVTOBUSY</button>

                <div id="busResults"></div>
            </div>

            <div id="booking" class="page">
                <h2><span class="sparkle">+</span> VYBOR MEST <span class="sparkle">+</span></h2>
                <div id="bookingContent"></div>
            </div>

            <div id="payment" class="page">
                <h2><span class="sparkle">*</span> OPLATA BILETA <span class="sparkle">*</span></h2>
                <div id="paymentContent"></div>
            </div>

            <div id="tickets" class="page">
                <h2><span class="sparkle">@</span> MOI BILETY <span class="sparkle">@</span></h2>
                <div id="ticketsContent"></div>
            </div>
        </div>

        <footer>
            <div class="counter" style="margin-bottom: 15px;">ONLINE USERS: 147</div>
            <p>Â© 2000-2026 AVTOBUS.UZ - All Rights Reserved</p>
            <p style="margin-top: 10px; color: #ff00ff;">Best viewed in 800x600</p>
        </footer>
    </div>

    <script>
        const storage = {
            selectedBus: null,
            selectedSeats: [],
            passengerData: null,
            tickets: []
        };

        const buses = [
            { id: 1, time: '08:00', duration: '4ch 30min', price: 45000, seats: 40, company: 'Uzbekistan Express' },
            { id: 2, time: '11:30', duration: '4ch 15min', price: 50000, seats: 40, company: 'Navoi Trans' },
            { id: 3, time: '15:00', duration: '4ch 45min', price: 42000, seats: 40, company: 'Silk Road Bus' },
            { id: 4, time: '19:00', duration: '4ch 20min', price: 48000, seats: 40, company: 'Central Asia Lines' }
        ];

        // --- NEW LOCAL STORAGE LOGIC ---
        function getTakenSeats(busId, date) {
            const key = `booked_seats_${busId}_${date}`;
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : [];
        }

        function saveBookedSeats(busId, date, newSeats) {
            const key = `booked_seats_${busId}_${date}`;
            const current = getTakenSeats(busId, date);
            const updated = [...new Set([...current, ...newSeats])];
            localStorage.setItem(key, JSON.stringify(updated));
        }
        // --- END LOCAL STORAGE LOGIC ---

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.dataset.page;
                showPage(page);
            });
        });

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            if (pageId === 'tickets') {
                displayTickets();
            }
        }

        function searchBuses() {
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const date = document.getElementById('date').value;
            
            if (!date) {
                alert('Pozhaluista, vyberite datu!');
                return;
            }

            if (from === to) {
                alert('Gorod otpravleniya i naznacheniya ne mogut sovpadat!');
                return;
            }

            const results = document.getElementById('busResults');
            results.innerHTML = '<h2 style="font-size: 20px; margin: 30px 0; color: #00ffff;">[RESULTS] DOSTUPNYE REISY:</h2>';

            buses.forEach(bus => {
                const booked = getTakenSeats(bus.id, date);
                const available = bus.seats - booked.length;
                
                results.innerHTML += `
                    <div class="bus-card">
                        <div class="bus-header">
                            <div class="bus-time">${bus.time}</div>
                            <div class="bus-price">${bus.price.toLocaleString()} UZS</div>
                        </div>
                        <div class="bus-info">>>> Kompaniya: ${bus.company}</div>
                        <div class="bus-info">>>> Vremya v puti: ${bus.duration}</div>
                        <div class="bus-info">>>> Svobodnykh mest: ${available}/${bus.seats}</div>
                        <div class="bus-info">>>> Marshrut: ${from} -> ${to}</div>
                        <button class="btn-y2k" onclick="selectBus(${bus.id}, '${date}', '${from}', '${to}')">
                            [BOOK] ZABRONIROVAT
                        </button>
                    </div>
                `;
            });
        }

        function selectBus(busId, date, from, to) {
            const bus = buses.find(b => b.id === busId);
            storage.selectedBus = { ...bus, date, from, to };
            storage.selectedSeats = [];
            
            showPage('booking');
            renderSeatSelection();
        }

        function renderSeatSelection() {
            const content = document.getElementById('bookingContent');
            const bus = storage.selectedBus;
            
            content.innerHTML = `
                <div class="summary">
                    <h3>[INFO] INFORMATSIYA O REISE</h3>
                    <div class="summary-item">
                        <span>Marshrut:</span>
                        <strong>${bus.from} -> ${bus.to}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Data:</span>
                        <strong>${bus.date}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Vremya otpravleniya:</span>
                        <strong>${bus.time}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Kompaniya:</span>
                        <strong>${bus.company}</strong>
                    </div>
                </div>

                <h2 style="font-size: 20px; margin: 20px 0;">[SELECT] VYBERITE MESTA:</h2>
                <div class="legend">
                    <span class="legend-item">
                        <span class="legend-box" style="background: rgba(0, 255, 0, 0.2); border-color: #00ff00;"></span>
                        Svobodno
                    </span>
                    <span class="legend-item">
                        <span class="legend-box" style="background: rgba(255, 0, 255, 0.3); border-color: #ff00ff;"></span>
                        Zanyato
                    </span>
                    <span class="legend-item">
                        <span class="legend-box" style="background: rgba(255, 255, 0, 0.4); border-color: #ffff00;"></span>
                        Vybrano
                    </span>
                </div>
                <div class="seat-grid" id="seatGrid"></div>
                <div id="selectedInfo"></div>
            `;

            const grid = document.getElementById('seatGrid');
            const takenSeats = getTakenSeats(bus.id, bus.date);

            for (let i = 1; i <= 40; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.textContent = i;
                
                if (takenSeats.includes(i)) {
                    seat.classList.add('taken');
                } else {
                    seat.onclick = () => toggleSeat(i);
                }
                
                grid.appendChild(seat);
            }

            updateSelectedInfo();
        }

        function toggleSeat(seatNum) {
            const idx = storage.selectedSeats.indexOf(seatNum);
            if (idx > -1) {
                storage.selectedSeats.splice(idx, 1);
            } else {
                storage.selectedSeats.push(seatNum);
            }
            
            document.querySelectorAll('.seat').forEach(s => {
                const num = parseInt(s.textContent);
                if (storage.selectedSeats.includes(num)) {
                    s.classList.add('selected');
                } else if (!s.classList.contains('taken')) {
                    s.classList.remove('selected');
                }
            });
            
            updateSelectedInfo();
        }

        function updateSelectedInfo() {
            const info = document.getElementById('selectedInfo');
            if (storage.selectedSeats.length > 0) {
                const total = storage.selectedSeats.length * storage.selectedBus.price;
                info.innerHTML = `
                    <div class="summary">
                        <h3>[SELECTED] VYBRANNYE MESTA</h3>
                        <div class="summary-item">
                            <span>Mesta:</span>
                            <strong>${storage.selectedSeats.sort((a,b) => a-b).join(', ')}</strong>
                        </div>
                        <div class="summary-item">
                            <span>Kolichestvo:</span>
                            <strong>${storage.selectedSeats.length}</strong>
                        </div>
                        <div class="summary-item">
                            <span>Tsena za mesto:</span>
                            <strong>${storage.selectedBus.price.toLocaleString()} UZS</strong>
                        </div>
                        <div class="total">
                            [TOTAL] ITOGO: ${total.toLocaleString()} UZS
                        </div>
                    </div>
                    <button class="btn-y2k" onclick="proceedToPayment()">[NEXT] PEREITI K OPLATE</button>
                `;
            } else {
                info.innerHTML = '';
            }
        }

        function proceedToPayment() {
            if (storage.selectedSeats.length === 0) {
                alert('Pozhaluista, vyberite khotya by odno mesto!');
                return;
            }

            showPage('payment');
            renderPaymentForm();
        }

        function renderPaymentForm() {
            const content = document.getElementById('paymentContent');
            const total = storage.selectedSeats.length * storage.selectedBus.price;

            content.innerHTML = `
                <div class="summary">
                    <h3>[BOOKING] VASHE BRONIROVANIE</h3>
                    <div class="summary-item">
                        <span>Reis:</span>
                        <strong>${storage.selectedBus.from} -> ${storage.selectedBus.to} (${storage.selectedBus.time})</strong>
                    </div>
                    <div class="summary-item">
                        <span>Data:</span>
                        <strong>${storage.selectedBus.date}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Mesta:</span>
                        <strong>${storage.selectedSeats.sort((a,b) => a-b).join(', ')}</strong>
                    </div>
                    <div class="total">
                        [PAY] K OPLATE: ${total.toLocaleString()} UZS
                    </div>
                </div>

                <h2 style="font-size: 20px; margin: 20px 0;">[PASSENGER] DANNYE PASSAZHIRA</h2>
                <div class="form-group">
                    <label>[NAME] IMYA:</label>
                    <input type="text" id="firstName" placeholder="Vvedite imya">
                </div>
                <div class="form-group">
                    <label>[SURNAME] FAMILIYA:</label>
                    <input type="text" id="lastName" placeholder="Vvedite familiyu">
                </div>
                <div class="form-group">
                    <label>[PHONE] TELEFON:</label>
                    <input type="tel" id="phone" placeholder="+998 XX XXX XX XX">
                </div>
                <div class="form-group">
                    <label>[PASSPORT] SERIYA I NOMER PASPORTA:</label>
                    <input type="text" id="passport" placeholder="AA 1234567">
                </div>

                <h2 style="font-size: 20px; margin: 20px 0;">[DEMO] SPOSOB OPLATY (DEMO)</h2>
                <div class="form-group">
                    <label>[CARD] NOMER KARTY:</label>
                    <input type="text" id="cardNumber" placeholder="8600 XXXX XXXX XXXX" maxlength="19">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                        <label>[EXPIRY] SROK DEISTVIYA:</label>
                        <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label>[CVV] CVV:</label>
                        <input type="text" id="cardCvv" placeholder="XXX" maxlength="3">
                    </div>
                </div>

                <button class="btn-y2k" onclick="processPayment()" style="width: 100%; font-size: 24px; margin-top: 20px;">
                    [CONFIRM] OPLATIT ${total.toLocaleString()} UZS
                </button>
            `;
        }

        function processPayment() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phone = document.getElementById('phone').value;
            const passport = document.getElementById('passport').value;
            const cardNumber = document.getElementById('cardNumber').value;

            if (!firstName || !lastName || !phone || !passport || cardNumber.length < 10) {
                alert('Pozhaluista, zapolnite vse polya!');
                return;
            }

            storage.passengerData = { firstName, lastName, phone, passport };

            const content = document.getElementById('paymentContent');
            content.innerHTML = `
                <div class="processing">
                    <h2 class="blink">[PROCESSING] OBRABOTKA PLATEZHA...</h2>
                    <div style="font-family: 'VT323', monospace; font-size: 24px; margin-top: 20px; color: #00ffff;">
                        Pozhaluista, podozhdite
                    </div>
                </div>
            `;

            setTimeout(() => {
                completeBooking();
            }, 3000);
        }

        function completeBooking() {
            // Save to Local Storage
            saveBookedSeats(storage.selectedBus.id, storage.selectedBus.date, storage.selectedSeats);

            const ticketId = Date.now();
            const ticket = {
                id: ticketId,
                bus: storage.selectedBus,
                seats: [...storage.selectedSeats],
                passenger: { ...storage.passengerData },
                total: storage.selectedSeats.length * storage.selectedBus.price,
                bookingDate: new Date().toLocaleString('ru-RU')
            };

            storage.tickets.push(ticket);

            const content = document.getElementById('paymentContent');
            content.innerHTML = `
                <div class="success-message">
                    <h2 class="blink">[SUCCESS] OPLATA USPESHNO ZAVERSHENA!</h2>
                    <div style="font-family: 'VT323', monospace; font-size: 24px; margin: 20px 0; color: #00ffff;">
                        Vash bilet zaronirovan!
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.8); border: 2px solid #00ffff; padding: 20px; margin: 20px 0;">
                        <div style="font-family: 'Press Start 2P', cursive; font-size: 20px; color: #ffff00;">
                            [ID] NOMER BRONI: ${ticketId}
                        </div>
                    </div>
                    <button class="btn-y2k" onclick="viewTickets()">
                        [VIEW] POSMOTRET MOI BILETY
                    </button>
                </div>
            `;
        }

        function viewTickets() {
            showPage('tickets');
        }

        function displayTickets() {
            const content = document.getElementById('ticketsContent');
            
            if (storage.tickets.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-family: 'VT323', monospace; font-size: 28px; color: #00ffff; margin-bottom: 20px;">
                            U vas poka net biletov
                        </div>
                        <button class="btn-y2k" onclick="showPage('search')">
                            [SEARCH] NAITI AVTOBUS
                        </button>
                    </div>
                `;
                return;
            }

            content.innerHTML = '<h2 style="font-size: 22px; margin-bottom: 20px; color: #00ffff;">[MY TICKETS] VASHI BILETY:</h2>';

            storage.tickets.forEach(ticket => {
                content.innerHTML += `
                    <div class="bus-card">
                        <div style="background: #000; color: #00ff00; padding: 15px; margin-bottom: 15px; font-family: 'VT323', monospace; font-size: 20px; border: 2px solid #00ff00;">
                            [BOOKING ID] NOMER BRONI: ${ticket.id}
                        </div>
                        <table>
                            <tr>
                                <th>PARAMETR</th>
                                <th>ZNACHENIE</th>
                            </tr>
                            <tr>
                                <td>Marshrut</td>
                                <td>${ticket.bus.from} -> ${ticket.bus.to}</td>
                            </tr>
                            <tr>
                                <td>Data poezdki</td>
                                <td>${ticket.bus.date}</td>
                            </tr>
                            <tr>
                                <td>Vremya otpravleniya</td>
                                <td>${ticket.bus.time}</td>
                            </tr>
                            <tr>
                                <td>Kompaniya</td>
                                <td>${ticket.bus.company}</td>
                            </tr>
                            <tr>
                                <td>Passazhir</td>
                                <td>${ticket.passenger.firstName} ${ticket.passenger.lastName}</td>
                            </tr>
                            <tr>
                                <td>Pasport</td>
                                <td>${ticket.passenger.passport}</td>
                            </tr>
                            <tr>
                                <td>Telefon</td>
                                <td>${ticket.passenger.phone}</td>
                            </tr>
                            <tr>
                                <td>Mesta</td>
                                <td>${ticket.seats.join(', ')}</td>
                            </tr>
                            <tr>
                                <td>Data bronirovaniya</td>
                                <td>${ticket.bookingDate}</td>
                            </tr>
                            <tr style="background: rgba(255, 255, 0, 0.3);">
                                <td><strong style="color: #ffff00;">[TOTAL] ITOGO</strong></td>
                                <td><strong style="color: #ffff00;">${ticket.total.toLocaleString()} UZS</strong></td>
                            </tr>
                        </table>
                    </div>
                `;
            });
        }

        document.getElementById('date').valueAsDate = new Date();
    </script>
</body>
</html>
